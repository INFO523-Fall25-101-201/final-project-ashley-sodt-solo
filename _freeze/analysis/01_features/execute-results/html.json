{
  "hash": "8bcc46c1a65c2770fa794fed894e75fc",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Session-level Features\"\nformat:\n  html:\n    code-tools: true\n    code-overflow: wrap\n    code-line-numbers: true\n    embed-resources: true\nexecute:\n  warning: false\n  message: false\njupyter: python3\n---\n\n::: {#load-pkgs .cell message='false' execution_count=1}\n``` {.python .cell-code}\nimport numpy as np\nimport pandas as pd\nfrom pathlib import Path\nfrom IPython.display import display\n\nHORSES_DIR = Path(\"..\") / \"Horses\"\nHORSES = [\"Duque\", \"Jackson\", \"Perseo\"]\n```\n:::\n\n\n::: {#summarize-session .cell message='false' execution_count=2}\n``` {.python .cell-code}\ndef summarize_session(csv_path: Path, horse: str) -> pd.Series:\n    \"\"\"\n    Summarize one EquiPro session into a single row of engineered features.\n    Computes summary stats for all numeric columns.\n    \"\"\"\n\n    df = pd.read_csv(csv_path)\n\n    # Parse session ID (timestamp portion)\n    stem = csv_path.stem   # e.g. '20240626T082743-Duque-results'\n    session_id = stem.replace(f\"-{horse}-results\", \"\")\n\n    numeric_cols = df.select_dtypes(include=\"number\").columns\n\n    stats = {}\n\n    for col in numeric_cols:\n        s = df[col].dropna()\n        if s.empty:\n            continue\n\n        q1, q3 = s.quantile([0.25, 0.75])\n\n        stats[f\"{col}_mean\"] = s.mean()\n        stats[f\"{col}_std\"] = s.std()\n        stats[f\"{col}_iqr\"] = q3 - q1\n        stats[f\"{col}_min\"] = s.min()\n        stats[f\"{col}_max\"] = s.max()\n\n    # Add metadata\n    stats[\"horse\"] = horse\n    stats[\"session_id\"] = session_id\n    stats[\"n_rows\"] = len(df)\n\n    return pd.Series(stats)\n```\n:::\n\n\n::: {#cell-build-feature-matrix .cell message='false' execution_count=3}\n``` {.python .cell-code}\nall_rows = []\n\nfor horse in HORSES:\n    horse_dir = HORSES_DIR / horse\n    csv_files = sorted(horse_dir.glob(\"*-results.csv\"))\n\n    print(f\"{horse}: found {len(csv_files)} sessions\")\n\n    for csv_path in csv_files:\n        row = summarize_session(csv_path, horse=horse)\n        all_rows.append(row)\n\nsession_features = pd.DataFrame(all_rows)\n\n# Ensure metadata columns come first\nmeta_cols = [\"horse\", \"session_id\", \"n_rows\"]\nother_cols = [c for c in session_features.columns if c not in meta_cols]\nsession_features = session_features[meta_cols + other_cols]\n\nprint(\"\\nSession-level feature matrix:\")\nprint(f\"  Shape: {session_features.shape[0]} sessions × {session_features.shape[1]} features\")\ndisplay(session_features.head())\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nDuque: found 14 sessions\nJackson: found 6 sessions\nPerseo: found 4 sessions\n\nSession-level feature matrix:\n  Shape: 24 sessions × 398 features\n```\n:::\n\n::: {#build-feature-matrix .cell-output .cell-output-display}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>horse</th>\n      <th>session_id</th>\n      <th>n_rows</th>\n      <th>segment_mean</th>\n      <th>segment_std</th>\n      <th>segment_iqr</th>\n      <th>segment_min</th>\n      <th>segment_max</th>\n      <th>stride_dur_mean</th>\n      <th>stride_dur_std</th>\n      <th>...</th>\n      <th>stride_speed_mean</th>\n      <th>stride_speed_std</th>\n      <th>stride_speed_iqr</th>\n      <th>stride_speed_min</th>\n      <th>stride_speed_max</th>\n      <th>stride_length_mean</th>\n      <th>stride_length_std</th>\n      <th>stride_length_iqr</th>\n      <th>stride_length_min</th>\n      <th>stride_length_max</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>Duque</td>\n      <td>20240626T082743</td>\n      <td>180</td>\n      <td>3.261111</td>\n      <td>1.496229</td>\n      <td>3.0</td>\n      <td>1</td>\n      <td>5</td>\n      <td>0.963107</td>\n      <td>0.262439</td>\n      <td>...</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>Duque</td>\n      <td>20240627T095239</td>\n      <td>149</td>\n      <td>2.597315</td>\n      <td>1.173580</td>\n      <td>2.0</td>\n      <td>1</td>\n      <td>5</td>\n      <td>0.988247</td>\n      <td>0.240448</td>\n      <td>...</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>Duque</td>\n      <td>20241122T111237</td>\n      <td>568</td>\n      <td>12.443662</td>\n      <td>7.252099</td>\n      <td>13.0</td>\n      <td>1</td>\n      <td>24</td>\n      <td>0.794038</td>\n      <td>0.234956</td>\n      <td>...</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>Duque</td>\n      <td>20241216T115742</td>\n      <td>520</td>\n      <td>6.284615</td>\n      <td>2.683668</td>\n      <td>2.0</td>\n      <td>1</td>\n      <td>12</td>\n      <td>0.880004</td>\n      <td>0.235219</td>\n      <td>...</td>\n      <td>1.276469</td>\n      <td>0.81591</td>\n      <td>1.1425</td>\n      <td>0.22</td>\n      <td>2.92</td>\n      <td>1.29011</td>\n      <td>0.650775</td>\n      <td>1.181125</td>\n      <td>0.2942</td>\n      <td>2.263</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>Duque</td>\n      <td>20241227T101523</td>\n      <td>345</td>\n      <td>5.478261</td>\n      <td>3.174245</td>\n      <td>6.0</td>\n      <td>1</td>\n      <td>12</td>\n      <td>0.814673</td>\n      <td>0.225847</td>\n      <td>...</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n  </tbody>\n</table>\n<p>5 rows × 398 columns</p>\n</div>\n```\n:::\n:::\n\n\n::: {#save-feature-matrix .cell message='false' execution_count=4}\n``` {.python .cell-code}\noutput_path = Path(\"data\") / \"session_features.csv\"\noutput_path.parent.mkdir(exist_ok=True)\n\nsession_features.to_csv(output_path, index=False)\n\nprint(f\"Saved feature matrix to: {output_path}\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSaved feature matrix to: data/session_features.csv\n```\n:::\n:::\n\n\n",
    "supporting": [
      "01_features_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js\" integrity=\"sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js\" integrity=\"sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}