{
  "hash": "dda8974d3491df0e59d307970ea3791a",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Session-level Features (Trot Only)\"\nformat:\n  html:\n    code-tools: true\n    code-overflow: wrap\n    code-line-numbers: true\n    embed-resources: true\nexecute:\n  warning: false\n  message: false\njupyter: python3\n---\n\n::: {#summarize-session .cell message='false' execution_count=1}\n``` {.python .cell-code}\nfrom pathlib import Path\nimport pandas as pd\n\n# Variables to keep\nTROT_VARS = [\n    \"stride_dur\",\"stride_speed\",\"stride_length\",\n    \"duty_factor\",\n    \"duty_factor_LF\",\"duty_factor_RF\",\"duty_factor_LH\",\"duty_factor_RH\",\n    \"stance_dur_LF\",\"stance_dur_RF\",\"stance_dur_LH\",\"stance_dur_RH\",\n    \"dap_L_sec\",\"dap_L_perc\",\"dap_R_sec\",\"dap_R_perc\",\n    \"min_diff_head\",\"max_diff_head\",\"si_up_head\",\n    \"min_diff_wth\",\"max_diff_wth\",\"si_up_wth\",\n    \"min_diff_sac\",\"max_diff_sac\",\"si_up_sac\"\n]\n\ndef summarize_session(csv_path: Path, horse: str) -> pd.Series:\n    \"\"\"Summarize a single EquiPro session (trot only).\"\"\"\n\n    df = pd.read_csv(csv_path)\n    df.columns = df.columns.str.strip()\n\n    # Filter to trot only\n    if \"gait\" in df.columns:\n        df = df[df[\"gait\"].str.lower() == \"trot\"]\n\n    # Extract session ID\n    stem = csv_path.stem\n    session_id = stem.replace(f\"-{horse}-results\", \"\")\n\n    stats = {}\n\n    for col in TROT_VARS:\n        if col not in df.columns:\n            continue\n\n        s = df[col].dropna()\n        if s.empty:\n            continue\n\n        q1, q3 = s.quantile([0.25, 0.75])\n\n        stats[f\"{col}_mean\"] = s.mean()\n        stats[f\"{col}_std\"] = s.std()\n        stats[f\"{col}_iqr\"] = q3 - q1\n        stats[f\"{col}_min\"] = s.min()\n        stats[f\"{col}_max\"] = s.max()\n\n    stats[\"horse\"] = horse\n    stats[\"session_id\"] = session_id\n    stats[\"n_rows\"] = len(df)\n\n    return pd.Series(stats)\n```\n:::\n\n\n::: {#cell-build-feature-matrix .cell message='false' execution_count=2}\n``` {.python .cell-code}\nHORSES = [\"Duque\", \"Jackson\", \"Perseo\"]\nHORSES_DIR = Path(\"..\") / \"Horses\"\n\nrows = []\n\nfor horse in HORSES:\n    horse_dir = HORSES_DIR / horse\n    csv_files = sorted(horse_dir.glob(\"*-results.csv\"))\n    print(f\"{horse}: {len(csv_files)} sessions\")\n\n    for csv_path in csv_files:\n        row = summarize_session(csv_path, horse)\n        rows.append(row)\n\nsession_features = pd.DataFrame(rows)\n\nmeta_cols = [\"horse\",\"session_id\",\"n_rows\"]\nother_cols = [c for c in session_features.columns if c not in meta_cols]\nsession_features = session_features[meta_cols + other_cols]\n\nsession_features.head()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nDuque: 14 sessions\nJackson: 6 sessions\nPerseo: 4 sessions\n```\n:::\n\n::: {#build-feature-matrix .cell-output .cell-output-display execution_count=2}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>horse</th>\n      <th>session_id</th>\n      <th>n_rows</th>\n      <th>stride_dur_mean</th>\n      <th>stride_dur_std</th>\n      <th>stride_dur_iqr</th>\n      <th>stride_dur_min</th>\n      <th>stride_dur_max</th>\n      <th>duty_factor_mean</th>\n      <th>duty_factor_std</th>\n      <th>...</th>\n      <th>stride_speed_mean</th>\n      <th>stride_speed_std</th>\n      <th>stride_speed_iqr</th>\n      <th>stride_speed_min</th>\n      <th>stride_speed_max</th>\n      <th>stride_length_mean</th>\n      <th>stride_length_std</th>\n      <th>stride_length_iqr</th>\n      <th>stride_length_min</th>\n      <th>stride_length_max</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>Duque</td>\n      <td>20240626T082743</td>\n      <td>117</td>\n      <td>0.776724</td>\n      <td>0.023376</td>\n      <td>0.031200</td>\n      <td>0.7269</td>\n      <td>0.8419</td>\n      <td>49.375284</td>\n      <td>1.883090</td>\n      <td>...</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>Duque</td>\n      <td>20240627T095239</td>\n      <td>88</td>\n      <td>0.791573</td>\n      <td>0.028649</td>\n      <td>0.040925</td>\n      <td>0.7225</td>\n      <td>0.8437</td>\n      <td>50.354495</td>\n      <td>2.172643</td>\n      <td>...</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>Duque</td>\n      <td>20241122T111237</td>\n      <td>368</td>\n      <td>0.747877</td>\n      <td>0.042264</td>\n      <td>0.058700</td>\n      <td>0.5925</td>\n      <td>0.8231</td>\n      <td>48.954408</td>\n      <td>2.418511</td>\n      <td>...</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>Duque</td>\n      <td>20241216T115742</td>\n      <td>391</td>\n      <td>0.774708</td>\n      <td>0.041307</td>\n      <td>0.053400</td>\n      <td>0.6431</td>\n      <td>0.8762</td>\n      <td>47.045350</td>\n      <td>1.916539</td>\n      <td>...</td>\n      <td>1.971923</td>\n      <td>0.969625</td>\n      <td>0.78</td>\n      <td>0.42</td>\n      <td>2.92</td>\n      <td>1.4951</td>\n      <td>0.734864</td>\n      <td>0.6378</td>\n      <td>0.3119</td>\n      <td>2.263</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>Duque</td>\n      <td>20241227T101523</td>\n      <td>231</td>\n      <td>0.756634</td>\n      <td>0.036294</td>\n      <td>0.043750</td>\n      <td>0.5763</td>\n      <td>0.8300</td>\n      <td>47.272270</td>\n      <td>1.399110</td>\n      <td>...</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n  </tbody>\n</table>\n<p>5 rows Ã— 128 columns</p>\n</div>\n```\n:::\n:::\n\n\n::: {#save .cell message='false' execution_count=3}\n``` {.python .cell-code}\nout = Path(\"data\") / \"session_features_trot.csv\"\nout.parent.mkdir(exist_ok=True)\nsession_features.to_csv(out, index=False)\nprint(f\"Saved: {out}\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSaved: data/session_features_trot.csv\n```\n:::\n:::\n\n\n",
    "supporting": [
      "01_features_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js\" integrity=\"sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js\" integrity=\"sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}