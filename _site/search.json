[
  {
    "objectID": "analysis/01_features.html",
    "href": "analysis/01_features.html",
    "title": "Session-level Features",
    "section": "",
    "text": "import numpy as np\nimport pandas as pd\nfrom pathlib import Path\nfrom IPython.display import display\n\nHORSES_DIR = Path(\"..\") / \"Horses\"\nHORSES = [\"Duque\", \"Jackson\", \"Perseo\"]\n\n\ndef summarize_session(csv_path: Path, horse: str) -&gt; pd.Series:\n    \"\"\"\n    Summarize one EquiPro session into a single row of engineered features.\n    Computes summary stats for all numeric columns.\n    \"\"\"\n\n    df = pd.read_csv(csv_path)\n\n    # Parse session ID (timestamp portion)\n    stem = csv_path.stem   # e.g. '20240626T082743-Duque-results'\n    session_id = stem.replace(f\"-{horse}-results\", \"\")\n\n    numeric_cols = df.select_dtypes(include=\"number\").columns\n\n    stats = {}\n\n    for col in numeric_cols:\n        s = df[col].dropna()\n        if s.empty:\n            continue\n\n        q1, q3 = s.quantile([0.25, 0.75])\n\n        stats[f\"{col}_mean\"] = s.mean()\n        stats[f\"{col}_std\"] = s.std()\n        stats[f\"{col}_iqr\"] = q3 - q1\n        stats[f\"{col}_min\"] = s.min()\n        stats[f\"{col}_max\"] = s.max()\n\n    # Add metadata\n    stats[\"horse\"] = horse\n    stats[\"session_id\"] = session_id\n    stats[\"n_rows\"] = len(df)\n\n    return pd.Series(stats)\n\n\nall_rows = []\n\nfor horse in HORSES:\n    horse_dir = HORSES_DIR / horse\n    csv_files = sorted(horse_dir.glob(\"*-results.csv\"))\n\n    print(f\"{horse}: found {len(csv_files)} sessions\")\n\n    for csv_path in csv_files:\n        row = summarize_session(csv_path, horse=horse)\n        all_rows.append(row)\n\nsession_features = pd.DataFrame(all_rows)\n\n# Ensure metadata columns come first\nmeta_cols = [\"horse\", \"session_id\", \"n_rows\"]\nother_cols = [c for c in session_features.columns if c not in meta_cols]\nsession_features = session_features[meta_cols + other_cols]\n\nprint(\"\\nSession-level feature matrix:\")\nprint(f\"  Shape: {session_features.shape[0]} sessions × {session_features.shape[1]} features\")\ndisplay(session_features.head())\n\nDuque: found 14 sessions\nJackson: found 6 sessions\nPerseo: found 4 sessions\n\nSession-level feature matrix:\n  Shape: 24 sessions × 398 features\n\n\n\n\n\n\n\n\n\nhorse\nsession_id\nn_rows\nsegment_mean\nsegment_std\nsegment_iqr\nsegment_min\nsegment_max\nstride_dur_mean\nstride_dur_std\n...\nstride_speed_mean\nstride_speed_std\nstride_speed_iqr\nstride_speed_min\nstride_speed_max\nstride_length_mean\nstride_length_std\nstride_length_iqr\nstride_length_min\nstride_length_max\n\n\n\n\n0\nDuque\n20240626T082743\n180\n3.261111\n1.496229\n3.0\n1\n5\n0.963107\n0.262439\n...\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\n\n\n1\nDuque\n20240627T095239\n149\n2.597315\n1.173580\n2.0\n1\n5\n0.988247\n0.240448\n...\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\n\n\n2\nDuque\n20241122T111237\n568\n12.443662\n7.252099\n13.0\n1\n24\n0.794038\n0.234956\n...\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\n\n\n3\nDuque\n20241216T115742\n520\n6.284615\n2.683668\n2.0\n1\n12\n0.880004\n0.235219\n...\n1.276469\n0.81591\n1.1425\n0.22\n2.92\n1.29011\n0.650775\n1.181125\n0.2942\n2.263\n\n\n4\nDuque\n20241227T101523\n345\n5.478261\n3.174245\n6.0\n1\n12\n0.814673\n0.225847\n...\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\n\n\n\n\n5 rows × 398 columns\n\n\n\n\noutput_path = Path(\"data\") / \"session_features.csv\"\noutput_path.parent.mkdir(exist_ok=True)\n\nsession_features.to_csv(output_path, index=False)\n\nprint(f\"Saved feature matrix to: {output_path}\")\n\nSaved feature matrix to: data/session_features.csv"
  }
]