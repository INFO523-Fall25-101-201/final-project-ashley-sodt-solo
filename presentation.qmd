---
title: "Clustering Movement Patterns in Equine Exercise Sessions"
subtitle: "INFO 523 - Fall 2025 - Final Project"
author: "Ashley Sodt"
title-slide-attributes:
  data-background-image: images/watercolour_sys02_img34_teacup-ocean.jpg
  data-background-size: stretch
  data-background-opacity: "0.7"
  data-slide-number: none
format:
  revealjs:
    theme:  ['data/customtheming.scss']
  
editor: visual
jupyter: python3
execute:
  echo: false
---

```{python}
#| label: load-packages
#| include: false

# Load packages here
import pandas as pd
import seaborn as sns

```

```{python}
#| label: setup
#| include: false
#| 
# Set up plot theme and figure resolution
sns.set_theme(style="whitegrid")
sns.set_context("notebook", font_scale=1.1)

import matplotlib.pyplot as plt
plt.rcParams['figure.dpi'] = 300
plt.rcParams['savefig.dpi'] = 300
plt.rcParams['figure.figsize'] = (6, 6 * 0.618)
```

```{python}
#| label: load-data
#| include: false
# Load data in Python
mtcars = sns.load_dataset('mpg').dropna()  # mtcars dataset is similar to the mpg dataset from seaborn
mtcars['speed'] = mtcars['horsepower'] / mtcars['weight']

penguins = sns.load_dataset('penguins').dropna()
```

## Introduction

-   Al-Marah Equine Center // Laura Miller

* EquiPro intertial measurement units collect accelerometer data
  + Outputs stride-level biomechanical metrics
  + Early detection of subtle gait abnormalities

* **Goal**: Use unsupervised learning techniques to model each horse's typical movement and automatically flag exercise sessions that deviate from this baseline. Such anomalies may reflect behavioral irregularities, equipment
malfunction, pain, or potential reinjury.

## Dataset

* Each session exported as CSV containing stride-level movemement variables.
  + Duque (14 sessions)
  + Jackson (6 sessions)
  + Perseo (5 sessions)

## Dataset {.smaller}
Sample of Equipro CSV output with stride-level biomechanical metrics from one exercise session.

```{python}
#| label: duque-head
#| warning: false
# Load one example Duque session

df_duque = pd.read_csv("Horses/Duque/20240626T082743-Duque-results.csv")

df_duque = pd.read_csv("Horses/Duque/20240626T082743-Duque-results.csv")
df_duque.head().style.set_properties(**{'font-size':'5px'})

# Show first 5 rows
df_duque.head()
```

# Methods

## Session-Level Features {.smaller}

We summarize **25 stride-level variables** into session-level features.

| Group                     | Biomechanical Variables                                    | Count |
|-------------------------:|:------------------------------------------------------|------:|
| **Stride Metrics**        | stride duration, speed, length                        | 3     |
| **Limb Loading / Timing** | duty factor (LF/RF/LH/RH), stance durations           | 12    |
| **Coordination**    | diagonal advanced placement (left / right)            | 4     |
| **Trunk Symmetry**        | head / withers / sacrum asymmetry + symmetry indices  | 6     |
| **Total**                 | —                                                     | **25** |

→ Each variable is summarized per session using: **mean, std, IQR, min, max**  
→ Producing **125 engineered features per session**


## Session-Level Feature Matrix {.smaller}

Feature matrix containing 24 exercise sessions and 125 engineered biomechanical movement features per session.

```{python}
import pandas as pd
from pathlib import Path

# Load the engineered feature matrix
data_path = Path("analysis") / "data" / "session_features_trot.csv"
session_features = pd.read_csv(data_path)

# Rows to display
rows_to_show = [1, 2, 16, 17, 22, 23]

display_cols = [
    "horse", "session_id", "n_rows",
    "stride_dur_mean", "stride_dur_std",
    "stride_dur_iqr","stride_dur_min","stride_dur_max"
]

# Display selected rows, clean formatting
session_features.loc[rows_to_show, display_cols] \
    .style.hide(axis="index") 
```

## Anomaly Detection Framework

- Convert every feature to a z-score.

- **Z-score Thresholding**: Flags sessions where any feature deviates strongly from the horse’s baseline.

- **K-means Cluster Distance**: Groups similar sessions and marks those far from their cluster center as outliers.

- **Isolation Forest**: Identifies sessions that are difficult to group with others (unusual combinations of features).

Sessions flagged by multiple methods are more likely to reflect real gait irregularities.

# Results

## Anomalies Flagged by Individual Methods

| Method               | Duque | Jackson | Perseo |
|---------------------|:-----:|:-------:|:------:|
| Z-score threshold   | **7** | 0 | 0 |
| K-means distance    | **3** | **2** | **2** |
| Isolation Forest    | **4** | **2** | 0 |




## High-Confidence Anomalies {.smaller}

Sessions flagged by ≥2 methods (strongest evidence of abnormal movement):

| Horse   | Session ID       |  Methods Flagged |
|--------|-------------------|:----------------:|
| Duque   | 20250804T082647  | **3** |
| Duque   | 20250309T134916  | **3** |
| Duque   | 20250308T111144  | **3** |
| Duque   | 20240627T095239  | **2** |
| Jackson | 20241215T152135  | **2** |

These sessions consistently deviate from each horse’s typical movement pattern.

## Layouts
text

::: columns
::: {.column width="40%"}
-   or bullet points[^1]
:::

::: {.column width="60%"}
or in two columns
:::
:::

[^1]: And add footnotes

-   like

-   this

## Code

```{python}
from sklearn.linear_model import LinearRegression
import statsmodels.api as sm
import pandas as pd

# Fit a linear regression model
X = mtcars[['speed']]
y = mtcars['mpg']
model = LinearRegression().fit(X, y)

# Summary of the model
X2 = sm.add_constant(X)
est = sm.OLS(y, X2)
est2 = est.fit()
print(est2.summary())
```

## Plots

```{python}
penguins['species'] = penguins['species'].apply(lambda x: "Adelie" if x == "Adelie" else "Other")
sns.scatterplot(data=penguins, x='flipper_length_mm', y='body_mass_g', hue='species')
plt.show()
```

## Plot and text

::: columns
::: {.column width="50%"}
-   Some text

-   goes here
:::

::: {.column width="50%"}
```{python}
#| warning: false
#| fig.width: 5.5
fig, ax = plt.subplots(figsize=(5.5, 5.5 * 0.618))
sns.boxplot(data=penguins, x='bill_length_mm', y='species', hue='species', ax=ax)
plt.show()
```
:::
:::

# A new section...

## Tables

If you want to generate a table, make sure it is in the HTML format (instead of Markdown or other formats), e.g.,

```{python}
penguins.head().to_html()
```

## Images

![Image credit: Danielle Navarro, Percolate.](images/watercolour_sys02_img34_teacup-ocean.png){fig-align="center" width="500"}

## Math Expressions {.smaller}

You can write LaTeX math expressions inside a pair of dollar signs, e.g. \$\\alpha+\\beta\$ renders $\alpha + \beta$. You can use the display style with double dollar signs:

```         
$$\bar{X}=\frac{1}{n}\sum_{i=1}^nX_i$$
```

$$
\bar{X}=\frac{1}{n}\sum_{i=1}^nX_i
$$

Limitations:

1.  The source code of a LaTeX math expression must be in one line, unless it is inside a pair of double dollar signs, in which case the starting `$$` must appear in the very beginning of a line, followed immediately by a non-space character, and the ending `$$` must be at the end of a line, led by a non-space character;

2.  There should not be spaces after the opening `$` or before the closing `$`.

# Wrap up

## Feeling adventurous?

-   You are welcomed to use the default styling of the slides. In fact, that's what I expect majority of you will do. You will differentiate yourself with the content of your presentation.

-   But some of you might want to play around with slide styling. Some solutions for this can be found at https://quarto.org/docs/presentations/revealjs.
