---
title: "Clustering Movement Patterns in Equine Exercise Sessions Using Anomaly Detection"
subtitle: "Proposal"
author: 
  - name: "Ashley Sodt"
    affiliations:
      - name: "Applied Math PhD Student, University of Arizona"
format:
  html:
    code-tools: true
    code-overflow: wrap
    code-line-numbers: true
    embed-resources: true
editor: visual
code-annotations: hover
execute:
  warning: false
  message: false
jupyter: python3
---

## Introduction
My goal is to use unsupervised learning techniques to cluster equine exercise sessions and detect
anomalies that may reflect behavioral irregularities, equipment issues, or potential reinjury.

I aim to detect abnormal equine exercise sessions by clustering 
movement-based features derived from processed EquiPro accelerometer data. Horses 
at the Al-Marah Equine Center are equipped with 7 accelerometers during exercise 
sessions on a lunge line at walk, trot, and canter. The EquiPro system outputs 
calculated biomechanical metrics such as diagonal advanced placement, stride 
duration, and footfall duration. By modeling typical movement patterns for each 
horse, I plan to identify exercise sessions that deviate significantly from a 
horse’s baseline. Such anomalies may reflect behavioral irregularities, equipment 
malfunction, pain, or potential reinjury. This is important in equine rehabilitation, 
where subtle changes in loading or symmetry can precede clinical signs of injury.

```{python}
#| label: load-pkgs
#| message: false

import numpy as np
import pandas as pd

from IPython.display import display
```

## Dataset

We analyze stride-level biomechanical metrics recorded by the EquiPro sessions
collected from three horses: Duque (14 sessions), Jackson (6 sessions), and Perseo (5 sessions).
Each session is stored as a CSV file containing time-sampled movement variables. 
I chose this dataset because (1) it is directly 
relevant to my research group’s goal of developing tools for equine rehabilitation 
monitoring, and (2) the repeated-session structure makes it well suited for unsupervised 
learning approaches. See below for an example of EquiPro CSV file structure from one exercise session.

```{python}
#| label: load-dataset
#| message: false

# Load one example Duque session to illustrate the raw data structure

df_duque = pd.read_csv("Horses/Duque/20240626T082743-Duque-results.csv")

print("\nExample Duque session from EquiPro:")
print(f"  - dataset shape: {df_duque.shape}")
print(f"  - number of rows: {df_duque.shape[0]}")
print(f"  - number of columns: {df_duque.shape[1]}")

print("\nFirst few rows:")
display(df_duque.head())

print("\nData types:")
display(df_duque.dtypes)

print("\nSummary statistics:")

# Select numeric columns
numeric_cols = df_duque.select_dtypes(include="number").columns

# Drop 'segment' column
numeric_cols = [c for c in numeric_cols if c != "segment"]

display(df_duque[numeric_cols].describe())
```

## Questions

Which exercise sessions significantly deviate from each horse’s baseline distribution, 
and which biomechanical variables contribute most strongly to those deviations?

How do different unsupervised anomaly-detection methods (Z-score thresholding, K-means cluster distance, 
and Isolation Forest) compare in identifying abnormal sessions, and to what extent do they 
agree or disagree on which sessions are flagged as anomalous?

## Analysis plan

For this project, I analyze only trot strides. The trot is a highly symmetric
gait which makes it convenient to study. More importantly, however,
mixing gaits would introduce variability unrelated to movement abnormalities.
For each exercise session, I will load the corresponding EquiPro CSV file and extract 
biomechanical variables relevant to symmetry, gait, and stride mechanics. To create 
session-level features, I will summarize each variable using statistics like mean, 
standard deviation, interquartile range, etc. These engineered features will form 
a feature matrix for each horse where each row is a session and each column is a 
biomechanical variable.

I will then model each horse's baseline movement patterns. I will standardize all 
features within each horse by converting them to z-scores in order to remove scale 
differences. This will provide a clear reference point. Features consistently close 
to zero after standardization indicate typical behavior, but large positive or negative 
values indicate potential deviations. These standardized distributions form the baseline 
against which the anomaly-detection methods will evaluate whether any given session 
departs significantly from a horse’s typical movement pattern.

After establishing the baselines for each horse using z-scores, I will apply three 
unsupervised anomaly-detection methods to identify sessions that deviate from typical 
movement. Z-score analysis will allow me to flag sessions where specific features 
are unusually high or low relative to baseline distribution. K-means clustering will 
identify anomalies based on their distance from cluster centers in the multivariate 
feature space. Isolation Forest will give a measure of how isolated a session is from 
the rest. Each method will produce a numerical anomaly score and a corresponding label 
indicating whether the session is considered abnormal.

I will then compare the results between the three methods. I will look for overlap 
between flagged sessions, sessions consistently identified as outliers, and note where 
the methods differ. I will also interpret the identified anomalies as they relate to 
biomechanical variables. I will inspect which specific features contribute most strongly 
to deviations from baseline. This could give insight as to possible explanations for 
deviations: behavioral irregularities, equipment malfunction, pain, or potential reinjury.

No external datasets will be merged.
